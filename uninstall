#!/usr/bin/env bash
set -euo pipefail

usage() {
    cat <<'EOF'
Usage: uninstall [PREFIX]

Remove wpy and wuv from PREFIX/bin. Defaults to $HOME/.local/bin.
EOF
}

if [[ "${1-}" == "--help" || "${1-}" == "-h" ]]; then
    usage
    exit 0
fi

prefix="${1:-"$HOME/.local"}"
bindir="$prefix/bin"

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source_bindir="$script_dir/bin"

if [[ ! -d "$source_bindir" ]]; then
    echo "Error: bin directory not found at $source_bindir" >&2
    exit 1
fi

tools=()

shopt -s nullglob
for source_path in "$source_bindir"/*; do
    [[ -f "$source_path" ]] || continue
    tools+=("$(basename "$source_path")")
done
shopt -u nullglob

if [[ ${#tools[@]} -eq 0 ]]; then
    echo "No tools found in $source_bindir" >&2
    exit 1
fi

for tool in "${tools[@]}"; do
    target="$bindir/$tool"
    if [[ -e "$target" ]]; then
        rm -f "$target"
        echo "Removed $target"
    else
        echo "Skipped $target (not found)"
    fi
done

echo "Finished uninstalling ${#tools[@]} tool(s) from $bindir"
